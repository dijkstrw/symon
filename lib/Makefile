# $Id: Makefile,v 1.14 2008/01/30 13:19:40 dijkstra Exp $
OS!=uname -s
.include "../platform/${OS}/Makefile.inc"
.include "../Makefile.inc"

SRCS=   error.c lex.c xmalloc.c net.c data.c
OBJS+=	${SRCS:R:S/$/.o/g}
CFLAGS+=-I../platform/${OS} -I.

all: libsymon.a

${OBJS}: conf.h ../Makefile.inc

libsymon.a: ${OBJS}
	@echo building standard symon library
	@rm -f libsymon.a
	@${AR} cq libsymon.a `${LORDER} ${OBJS} | ${TSORT}`
	${RANLIB} libsymon.a

conf.h:  Makefile ../Makefile.inc
	@echo Generating $@ on ${OS}
	@echo "/* This file was automagically generated by make */" > $@
	@echo "#define SYMON_CONFIG_FILE \"$(SYSCONFDIR)/symon.conf\""  >> $@
	@echo "#define SYMON_VERSION \"$(V)\"" >> $@
	@echo "#define SYMON_PLATFORM \"${OS}\"" >> $@
	@echo "#include \"../platform/${OS}/platform.h\"" >> $@
	@if [ -f ../platform/${OS}/conf.sh ]; then sh ../platform/${OS}/conf.sh >> $@; fi

clean:
	rm -f conf.h libsymon.a ${OBJS}

install: libsymon.a
